<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Passman Local Moderno</title>
<style>
body, html { margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; color:#333; }
h1 { margin:0 0 12px; font-size:28px; color:#222; }

/* --- Containers --- */
.container { max-width:1100px; margin:20px auto; padding:0 16px; }
.area { background:#fff; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
.top { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:12px; position:sticky; top:0; background:#f0f2f5; padding-top:8px; padding-bottom:8px; z-index:5; }

/* --- Inputs e botões --- */
input[type="text"], textarea { padding:10px; border-radius:8px; border:1px solid #ccc; width:100%; font-size:14px; transition:0.2s; }
input[type="text"]:focus, textarea:focus { border-color:#4a90e2; outline:none; }
textarea { resize:vertical; }

button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:600; transition:0.2s; }
button:hover { opacity:0.9; }

button.add { background:#4CAF50; color:#fff; }
button.edit { background:#2196F3; color:#fff; }
button.delete { background:#f44336; color:#fff; }
button.copy { background:#FF9800; color:#fff; }
button.copyEmail { background:#00bcd4; color:#fff; }
button.cancel { background:#aaa; color:#fff; }
button.export { background:#607d8b; color:#fff; }
button.import { background:#795548; color:#fff; }
.tag { display:inline-block; padding:3px 8px; border-radius:12px; margin-right:4px; margin-bottom:2px; font-size:12px; background:#e0f0ff; color:#0077cc; transition:0.2s; cursor:pointer; }
.tag:hover { background:#0077cc; color:#fff; }

/* --- Tabela --- */
table { width:100%; border-collapse:collapse; }
th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; vertical-align:top; font-size:14px; }
th { background:#f7f7f7; color:#333; font-weight:600; }

/* --- Modal --- */
.modal { display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.35); justify-content:center; align-items:center; z-index:10; }
.modal-content { background:#fff; border-radius:12px; padding:24px; width:90%; max-width:720px; box-shadow:0 8px 20px rgba(0,0,0,0.2); transition:0.3s; }
.modal h3 { margin-top:0; margin-bottom:16px; }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.modal-buttons { display:flex; justify-content:flex-end; gap:8px; margin-top:16px; }

/* --- Responsivo --- */
@media(max-width:720px){ .form-row { grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="container">
  <h1>Passman Local Moderno</h1>

  <div class="area top">
    <input id="q" type="text" placeholder="Pesquisar por título, email, tags ou notas...">
    <button id="btnAdd" class="add">➕ Nova conta</button>
    <button id="btnExportCSV" class="export">Exportar CSV</button>
    <button id="btnImportCSV" class="import">Importar CSV</button>
    <button id="btnExportJSON" class="export">Backup JSON</button>
    <input id="fileInput" type="file" accept=".csv,.json" style="display:none;">
  </div>

  <div class="area">
    <table id="table">
      <thead>
        <tr><th>Título</th><th>Email</th><th>Tags</th><th>Notas</th><th style="width:260px">Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Nova conta</h3>
    <div class="form-row">
      <div>
        <label>Título</label><br>
        <input id="fieldTitle" type="text">
      </div>
      <div>
        <label>Email / usuário</label><br>
        <input id="fieldEmail" type="text">
      </div>
    </div>
    <div style="margin-top:12px">
      <label>Senha</label><br>
      <input id="fieldPassword" type="text">
    </div>
    <div style="margin-top:12px">
      <label>Tags (vírgula)</label><br>
      <input id="fieldTags" type="text">
    </div>
    <div style="margin-top:12px">
      <label>Notas</label><br>
      <textarea id="fieldNotes" rows="4"></textarea>
    </div>
    <div class="modal-buttons">
      <button id="modalCancel" class="cancel">Cancelar</button>
      <button id="modalSave" class="add">Salvar</button>
    </div>
  </div>
</div>

<script>
const LS_KEY = "passman_accounts_modern";
let accounts = [], editingId = null, activeTagFilter = null;

function uid(){ return Math.floor(Math.random()*1e9); }
function saveAll(){ localStorage.setItem(LS_KEY, JSON.stringify(accounts)); }
function loadAll(){ const raw=localStorage.getItem(LS_KEY); accounts=raw?JSON.parse(raw):[]; }

function render(filter=""){
  const tbody = document.querySelector("#table tbody");
  tbody.innerHTML = "";
  const q = (filter||"").trim().toLowerCase();
  const list = accounts.slice().sort((a,b)=>(a.title||"").localeCompare(b.title||""));
  for(const it of list){
    const combined = `${it.title} ${it.email} ${it.tags} ${it.notes}`.toLowerCase();
    if(q && !combined.includes(q)) continue;
    if(activeTagFilter && !(it.tags||"").toLowerCase().split(",").map(t=>t.trim()).includes(activeTagFilter)) continue;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${escapeHtml(it.title||"")}</td>
      <td>${escapeHtml(it.email||"")}</td>
      <td>${(it.tags||"").split(",").map(t=>t.trim()).filter(Boolean).map(t=>'<span class="tag" data-tag="'+t.toLowerCase()+'">'+escapeHtml(t)+'</span>').join(" ")}</td>
      <td title="${escapeHtml(it.notes||"")}">${truncate(escapeHtml(it.notes||""),80)}</td>
      <td>
        <button class="copy" data-id="${it.id}">Copiar Senha</button>
        <button class="copyEmail" data-id="${it.id}">Copiar Email</button>
        <button class="edit" data-id="${it.id}">Editar</button>
        <button class="delete" data-id="${it.id}">Excluir</button>
      </td>`;
    tbody.appendChild(tr);
  }
  attachButtons();
  attachTagFilters();
}

function attachButtons(){
  document.querySelectorAll(".copy").forEach(b=>b.onclick=async()=>{
    const id=Number(b.dataset.id); 
    const acc=accounts.find(x=>x.id===id); 
    if(!acc) return;
    try { await navigator.clipboard.writeText(acc.password||""); } catch(e){ }
  });
  document.querySelectorAll(".copyEmail").forEach(b=>b.onclick=async()=>{
    const id=Number(b.dataset.id); 
    const acc=accounts.find(x=>x.id===id); 
    if(!acc) return;
    try { await navigator.clipboard.writeText(acc.email||""); } catch(e){ }
  });
  document.querySelectorAll(".edit").forEach(b=>b.onclick=()=>openModalForEdit(Number(b.dataset.id)));
  document.querySelectorAll(".delete").forEach(b=>b.onclick=()=>{
    const id=Number(b.dataset.id); if(!confirm("Excluir esta conta?"))return;
    accounts=accounts.filter(x=>x.id!==id); saveAll(); render(document.getElementById("q").value);
  });
}

function attachTagFilters(){
  document.querySelectorAll(".tag").forEach(t=>{
    t.onclick=()=>{
      const tag=t.dataset.tag;
      if(activeTagFilter===tag) activeTagFilter=null;
      else activeTagFilter=tag;
      render(document.getElementById("q").value);
    }
  });
}

function openModalForNew(){ editingId=null; document.getElementById("modalTitle").textContent="Nova conta"; ["fieldTitle","fieldEmail","fieldPassword","fieldTags","fieldNotes"].forEach(id=>document.getElementById(id).value=""); showModal(true);}
function openModalForEdit(id){ const acc=accounts.find(x=>x.id===id); if(!acc)return; editingId=id; document.getElementById("modalTitle").textContent="Editar conta"; document.getElementById("fieldTitle").value=acc.title||""; document.getElementById("fieldEmail").value=acc.email||""; document.getElementById("fieldPassword").value=acc.password||""; document.getElementById("fieldTags").value=acc.tags||""; document.getElementById("fieldNotes").value=acc.notes||""; showModal(true);}
function showModal(show){ document.getElementById("modal").style.display = show?"flex":"none"; }
function truncate(s,n){ return s&&s.length>n?s.slice(0,n-1)+"…":s||""; }
function escapeHtml(s){ return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"); }

document.getElementById("btnAdd").onclick=openModalForNew;
document.getElementById("modalCancel").onclick=()=>showModal(false);
document.getElementById("modalSave").onclick=()=>{
  const title=document.getElementById("fieldTitle").value.trim();
  const email=document.getElementById("fieldEmail").value.trim();
  const password=document.getElementById("fieldPassword").value;
  const tags=document.getElementById("fieldTags").value.trim();
  const notes=document.getElementById("fieldNotes").value.trim();
  if(!title && !email) return;
  if(editingId==null){ accounts.push({id:uid(), title,email,password,tags,notes,created:Date.now()}); }
  else{ const a=accounts.find(x=>x.id===editingId); if(!a)return; a.title=title; a.email=email; a.password=password; a.tags=tags; a.notes=notes; }
  saveAll(); showModal(false); render(document.getElementById("q").value);
};

document.getElementById("q").addEventListener("input", e=>render(e.target.value));

function accountsToCSV(arr){ const rows=[["title","email","password","tags","notes"]]; for(const a of arr)rows.push([a.title||"",a.email||"",a.password||"",a.tags||"",a.notes||""]); return rows.map(r=> r.map(c=>`"${String(c||"").replaceAll('"','""')}"`).join(",")).join("\n"); }
function download(filename,text){ const blob=new Blob([text],{type:"text/plain;charset=utf-8"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

document.getElementById("btnExportCSV").onclick=()=>download("passman_export.csv",accountsToCSV(accounts));
document.getElementById("btnExportJSON").onclick=()=>download("passman_export.json",JSON.stringify(accounts,null,2));

document.getElementById("btnImportCSV").onclick=()=>{
  const fi=document.getElementById("fileInput"); fi.accept=".csv,.json"; fi.value=""; fi.onchange=async()=>{
    const f=fi.files[0]; if(!f)return; const text=await f.text();
    if(f.name.toLowerCase().endsWith(".json")){ try{ const j=JSON.parse(text); if(Array.isArray(j)){ for(const it of j){ if(!it.id) it.id=uid(); accounts.push(it); } saveAll(); render(document.getElementById("q").value); } } catch(e){ } }
    else{ const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean); if(lines.length<2)return; const header=parseCSVLine(lines[0]).map(h=>h.toLowerCase()); for(let i=1;i<lines.length;i++){ const row=parseCSVLine(lines[i]); const obj={}; for(let c=0;c<header.length;c++)obj[header[c]]=row[c]||""; accounts.push({id:uid(), title:obj.title||"", email:obj.email||"", password:obj.password||"", tags:obj.tags||"", notes:obj.notes||""}); } saveAll(); render(document.getElementById("q").value); } fi.value=""; };
  fi.click();
};

function parseCSVLine(line){ const out=[]; let cur="", inQ=false; for(let i=0;i<line.length;i++){ const ch=line[i]; if(inQ){ if(ch=='"'){ if(line[i+1]=='"'){cur+='"'; i++;} else inQ=false;} else cur+=ch;} else{ if(ch==','){out.push(cur); cur="";} else if(ch=='"'){inQ=true;} else cur+=ch; } } out.push(cur); return out; }

loadAll(); render();
</script>
</body>
</html>
