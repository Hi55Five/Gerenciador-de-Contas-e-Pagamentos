<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerenciador de Contas e Pagamentos</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f2f4f8;
      margin: 0;
      padding: 0;
    }
    header {
      background: #4f46e5;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .actions input, .actions button {
      margin: 0.25rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
    }
    .actions input {
      flex: 1;
      border: 1px solid #ccc;
    }
    .actions button {
      background: #4f46e5;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    .actions button:hover {
      background: #3730a3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f9fafb;
    }
    .tag {
      background: #e0e7ff;
      color: #3730a3;
      padding: 2px 6px;
      border-radius: 6px;
      margin-right: 4px;
      display: inline-block;
      font-size: 0.8rem;
    }
    .btn-small {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      border: none;
      margin: 2px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .copy { background: #3b82f6; color: white; }
    .copyEmail { background: #0ea5e9; color: white; }
    .edit { background: #facc15; color: black; }
    .delete { background: #ef4444; color: white; }
    .paid { background: #22c55e; color: white; }
    .status-pendente { color: #dc2626; font-weight: bold; }
    .status-pago { color: #16a34a; font-weight: bold; }
    .vencido { background: #fee2e2 !important; }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      width: 95%;
      max-width: 400px;
    }
    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.25rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .modal-content button {
      margin-top: 0.5rem;
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 6px;
      background: #4f46e5;
      color: white;
    }
    /* Resumo */
    .resumo {
      margin: 1rem 0;
      background: #e0f2fe;
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
    }
    /* Responsivo */
    @media (max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead { display: none; }
      tr { margin-bottom: 1rem; background: white; padding: 0.5rem; border-radius: 8px; }
      td {
        border: none;
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
      }
    }
  </style>
</head>
<body>
<header>Gerenciador de Contas e Pagamentos</header>
<div class="container">
  <div class="actions">
    <input type="text" id="q" placeholder="Pesquisar...">
    <button onclick="openModal()">+ Adicionar</button>
    <button onclick="exportJSON()">Exportar JSON</button>
    <button onclick="importJSON()">Importar JSON</button>
    <button onclick="exportCSV()">Exportar CSV</button>
    <button onclick="importCSV()">Importar CSV</button>
  </div>

  <div class="resumo" id="resumo">Resumo: R$0 pagos / R$0 pendentes</div>

  <table id="tabela">
    <thead>
      <tr>
        <th>T√≠tulo</th>
        <th>Email</th>
        <th>Tags</th>
        <th>Valor</th>
        <th>Vencimento</th>
        <th>Status</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modal-title">Adicionar Conta</h3>
    <input type="hidden" id="acc-id">
    <input type="text" id="title" placeholder="T√≠tulo">
    <input type="text" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Senha">
    <input type="text" id="tags" placeholder="Tags (separadas por v√≠rgula)">
    <input type="number" id="valor" placeholder="Valor (R$)" step="0.01">
    <input type="date" id="vencimento">
    <textarea id="notes" placeholder="Notas"></textarea>
    <button onclick="saveAccount()">Salvar</button>
    <button onclick="closeModal()" style="background:#9ca3af">Cancelar</button>
  </div>
</div>

<script>
let accounts = [];

function uid(){ return Date.now()+Math.random(); }
function saveAll(){ localStorage.setItem("accounts", JSON.stringify(accounts)); }
function loadAll(){ accounts = JSON.parse(localStorage.getItem("accounts")||"[]"); }

function render(q=""){
  const tbody=document.querySelector("#tabela tbody");
  tbody.innerHTML="";
  let totalPago=0, totalPendente=0;
  const hoje = new Date().toISOString().split("T")[0];
  accounts.filter(a=>
    a.title.toLowerCase().includes(q.toLowerCase()) || 
    a.email.toLowerCase().includes(q.toLowerCase())
  ).forEach(acc=>{
    const tr=document.createElement("tr");
    if(acc.status==="Pendente" && acc.vencimento && acc.vencimento<hoje){
      tr.classList.add("vencido");
    }
    tr.innerHTML=`
      <td data-label="T√≠tulo">${acc.title}</td>
      <td data-label="Email">${acc.email}</td>
      <td data-label="Tags">${acc.tags.split(",").map(t=>`<span class='tag'>${t.trim()}</span>`).join("")}</td>
      <td data-label="Valor">R$${Number(acc.valor||0).toFixed(2)}</td>
      <td data-label="Vencimento">${acc.vencimento||""}</td>
      <td data-label="Status"><span class="${acc.status==="Pago"?"status-pago":"status-pendente"}">${acc.status}</span></td>
      <td data-label="A√ß√µes">
        <button class="btn-small copyEmail" onclick="copyToClipboard('${acc.email}')">üìß</button>
        <button class="btn-small copy" onclick="copyToClipboard('${acc.password}')">üîë</button>
        <button class="btn-small edit" onclick="openModal(${acc.id})">‚úèÔ∏è</button>
        <button class="btn-small delete" onclick="delAccount(${acc.id})">üóëÔ∏è</button>
        <button class="btn-small paid" onclick="markPaid(${acc.id})">üíµ</button>
      </td>
    `;
    tbody.appendChild(tr);
    if(acc.status==="Pago") totalPago+=Number(acc.valor||0);
    else totalPendente+=Number(acc.valor||0);
  });
  document.getElementById("resumo").innerText=`Resumo: R$${totalPago.toFixed(2)} pagos / R$${totalPendente.toFixed(2)} pendentes`;
}

function copyToClipboard(text){
  navigator.clipboard.writeText(text);
}

function openModal(id=null){
  document.getElementById("modal").style.display="flex";
  if(id){
    const acc=accounts.find(a=>a.id===id);
    document.getElementById("modal-title").innerText="Editar Conta";
    document.getElementById("acc-id").value=acc.id;
    document.getElementById("title").value=acc.title;
    document.getElementById("email").value=acc.email;
    document.getElementById("password").value=acc.password;
    document.getElementById("tags").value=acc.tags;
    document.getElementById("valor").value=acc.valor;
    document.getElementById("vencimento").value=acc.vencimento;
    document.getElementById("notes").value=acc.notes;
  } else {
    document.getElementById("modal-title").innerText="Adicionar Conta";
    document.getElementById("acc-id").value="";
    document.querySelectorAll("#modal input, #modal textarea").forEach(e=>e.value="");
  }
}
function closeModal(){ document.getElementById("modal").style.display="none"; }

function saveAccount(){
  const id=document.getElementById("acc-id").value;
  const data={
    id: id?Number(id):uid(),
    title: document.getElementById("title").value,
    email: document.getElementById("email").value,
    password: document.getElementById("password").value,
    tags: document.getElementById("tags").value,
    valor: document.getElementById("valor").value,
    vencimento: document.getElementById("vencimento").value,
    notes: document.getElementById("notes").value,
    status: id?accounts.find(a=>a.id==id).status:"Pendente"
  };
  if(id){
    const i=accounts.findIndex(a=>a.id==id);
    accounts[i]=data;
  } else {
    accounts.push(data);
  }
  saveAll(); closeModal(); render(document.getElementById("q").value);
}
function delAccount(id){ accounts=accounts.filter(a=>a.id!==id); saveAll(); render(document.getElementById("q").value); }
function markPaid(id){
  const acc=accounts.find(a=>a.id===id);
  if(acc){ acc.status="Pago"; saveAll(); render(document.getElementById("q").value); }
}

function exportJSON(){
  const blob=new Blob([JSON.stringify(accounts)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="accounts.json"; a.click();
}
function importJSON(){
  const fi=document.createElement("input"); fi.type="file"; fi.accept=".json";
  fi.onchange=e=>{
    const fr=new FileReader();
    fr.onload=()=>{ accounts=JSON.parse(fr.result); saveAll(); render(); };
    fr.readAsText(fi.files[0]);
  };
  fi.click();
}

// Exportar CSV
function exportCSV(){
  const header = ["title","email","password","tags","valor","vencimento","status","notes"];
  const rows = accounts.map(acc=>header.map(h=>`"${(acc[h]||"").toString().replace(/"/g,'""')}"`).join(","));
  const csv = header.join(",") + "\n" + rows.join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="accounts.csv"; a.click();
}

// Importar CSV
function importCSV(){
  const fi=document.createElement("input"); fi.type="file"; fi.accept=".csv";
  fi.onchange=e=>{
    const fr=new FileReader();
    fr.onload=()=>{
      const lines=fr.result.split("\n").filter(l=>l.trim()!=="");
      const header=lines[0].split(",").map(h=>h.trim().replace(/"/g,""));
      accounts=[];
      for(let i=1;i<lines.length;i++){
        const cols=lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)||[];
        const obj={};
        header.forEach((h,idx)=>{ obj[h]=cols[idx]?cols[idx].replace(/^"|"$/g,""):""; });
        accounts.push({
          id: uid(),
          title: obj.title||"",
          email: obj.email||"",
          password: obj.password||"",
          tags: obj.tags||"",
          valor: obj.valor||"",
          vencimento: obj.vencimento||"",
          status: obj.status||"Pendente",
          notes: obj.notes||""
        });
      }
      saveAll(); render();
    };
    fr.readAsText(fi.files[0]);
  };
  fi.click();
}

document.getElementById("q").addEventListener("input", e=>render(e.target.value));

loadAll(); render();
</script>
</body>
</html>